<html>
  <head>
  	<meta charset="utf-8">
  	<title>Wetherspoon Treasure Hunt</title>

  	<meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Fonts -->
    <!--  Nunito font is instead of Avenir, as avenir is very expensive -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Nunito:200,300,400" rel="stylesheet">
    <!-- Font Awesome  -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  	<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="./assets/application.css">

    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/lodash/4.17.2/lodash.min.js"></script>

    <!--
      * To allow injecting of HTML subpages
      * Example: <div w3-include-html="content.html"></div>
     -->
    <script src="./assets/js/w3data.js"></script>

  </head>
  <body>
    <!-- Page One -->
    <div data-role="page" id="home">
      <!-- Home Page -->
      <div data-role="header" data-position="fixed" class="header">
        <h1 class="logo"><b>wetherspoon</b> / GAME</h1>
      </div>
      <div role="main" class="ui-content" style="padding:0;">
        <div class="ui-grid-a" style="position: relative;">
          <img class="heading-image" src="./assets/images/background.jpg" alt="pub-inside-image">
          <div class="image-centered-text">Pubs Treasure Hunt</div>
        </div><!-- /grid-a -->
        <div style="height: 35%;" class="ui-grid-b dark-background" align="center">
          <p class="main-text-block">
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do.
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do
          </p>
          <a href="#find_pub" class="ui-btn ui-corner-all ui-shadow primary-button"  style="width: 60%;">Find a Pub</a>
        </div><!-- /grid-b -->

        <div style="height: 30%; margin-bottom: 20px;" class="ui-grid-c" align="center">
          <p class="main-text-block">
            <a href="#home_more" style="text-decoration: none;">
              FIND OUT MORE<br>
              <i class="fa fa-chevron-down" aria-hidden="true" style="font-size: 25px; color: black !important;"></i>
            </a>
          </p>
        </div><!-- /grid-c -->

        <div id="home_more" style="height: 30%; margin-bottom: 20px;" class="ui-grid-d" align="center">
          <p class="main-text-block">
            <i class="fa fa-book" aria-hidden="true" style="font-size: 60px; color: b3865c !important;"></i><br><br>
            Rules:<br>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do.Lorem ipsum dolor sit amet, consectetur a
          </p>
        </div><!-- /grid-d -->

        <div style="height: 30%;" class="ui-grid-e dark-background" align="center">
          <p class="main-text-block">
            <i class="fa fa-trophy" aria-hidden="true" style="font-size: 60px; color: b3865c !important;"></i><br><br>
            Trophies:<br>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do.Lorem ipsum dolor sit amet, consectetur a
          </p>
        </div><!-- /grid-e -->
      </div>

      <div style="height: 35%; margin-bottom: 20px;" class="ui-grid-b" align="center">
        <p class="main-text-block">
          <i class="fa fa-envelope" aria-hidden="true" style="font-size: 60px; color: b3865c !important;"></i><br><br>
          Subscribe to our newsletter<br>
          <div style="width: 80%;">
            <input type="email" name="newsletterEmail" placeholder="Enter email">
          </div>
        </p>
        <button class="ui-btn ui-corner-all ui-shadow primary-button" style="width: 60%;">Subscribe</button>
      </div><!-- /grid-b -->

      <div data-role="footer" class="footer">
        <h1>
          <i class="fa fa-facebook fa-2" aria-hidden="true"></i>&nbsp;&nbsp;
          <i class="fa fa-twitter" aria-hidden="true"></i>&nbsp;&nbsp;
          <i class="fa fa-instagram" aria-hidden="true"></i>
        </h1>
      </div>

    </div>

    <!-- Page two -->
    <div data-role="page" id="find_pub">
      <div w3-include-html="./pages/find_pub.html"></div>
    </div>

    <!-- Page three -->
    <div data-role="page" id="poi_page">
      <div w3-include-html="./pages/poi_page.html"></div>
    </div>

    <!-- Page four -->
    <div data-role="page" id="favorites">
      <div w3-include-html="./pages/favorites.html"></div>
    </div>

    <!-- Page five -->
    <div data-role="page" id="game">
      <div w3-include-html="./pages/game.html"></div>
    </div>

    <!-- Page six -->
    <div data-role="page" id="booking">
      <div w3-include-html="./pages/booking.html"></div>
    </div>

    <script>
      (function () {
        w3IncludeHTML();
      })();
    </script>

    <script>
      // Global store for everything
      var store = {
        favouritePubs: [],
        pubs: {
          0: {
            id: 0,
            name: 'Friend at Hand',
            description: 'a cosy little pub just tucked around the corner from Russel Squre tube station',
            pubGameDescription: 'asdasdas',
            address: '255–256 Upper Street Islington, London, N1 5AQ',
            telephone: '+44 7477 777 777',
            workingHours: 'Mon - Sun 08:00 - 00:00',
            game: {
              type: 'multipleChoice',
              description: 'What is displayed on the front door?',
              clues: [ 'Door 0', 'Beer0', 'Car 0' ],
              answers: [ 'hero One', 'Two heroes', 'Three' ],
              correctAnswer: 'Two heroes',
            }
          },
          1: {
            id: 1,
            name: 'Lamb',
            description: 'another pub very good on',
            pubGameDescription: 'lorem sero ldwqq lowerw',
            address: '255–256 Upper Street Islington, London, N1 5AQ',
            telephone: '+44 7477 777 777',
            workingHours: 'Mon - Sun 08:00 - 00:00',
            game: {
              type: 'multipleChoicePhoto',
              description: 'Photo',
              clues: [ 'Door 1', 'Beer1 ', 'Car 1' ],
              answers: [ 'One', 'Two', 'Three' ],
              correctAnswer: 'Two',
            }
          },
          2: {
            id: 2,
            name: 'Museum Tavern',
            description: 'another pub very good on',
            pubGameDescription: 'lorem sero ldwqq lowerw',
            address: '255–256 Upper Street Islington, London, N1 5AQ',
            telephone: '+44 7477 777 777',
            workingHours: 'Mon - Sun 08:00 - 00:00',
            game: {
              type: 'multipleChoice',
              description: 'Input What is displayed on the front door? Question 3',
              clues: [ 'Door', 'Beer', 'Car' ],
              answers: [ 'One', 'Two', 'Three' ],
              correctAnswer: 'Two',
            }
          }
        }
      };

      function loadPubData(id) {
        var pub = store.pubs[id] || store.pubs[0];

        $('#pub-name').text(pub.name);
        $('#pub-game-description').text(pub.pubGameDescription);
        $('#pub-address').text(pub.address);
        $('#pub-telephone').text(pub.telephone);
        $('#pub-working-hours').text(pub.workingHours);
        $('#pub-favourite-icon').html(
          '<i onclick="togglePubFavourite(this, ' + pub.id +')" class="fa fa-star'
          + (_.includes(store.favouritePubs, id) ? '' : '-o') + ' aria-hidden="true"></i>');

        $('#pub-action-buttons').html(
          '<a href="#game" onclick="loadPubGamePage(' + id + ')" class="ui-btn ui-corner-all ui-shadow primary-button" style="width: 40%;">Play</a>'
          + '<a href="#booking" class="ui-btn ui-corner-all ui-shadow primary-button" style="width: 40%;">Book</a>'
        );
      }

      function loadPubGamePage(id) {
        var pub = store.pubs[id] || store.pubs[0];
        var answers = '';

        // multipleChoice game type
        if (pub.game.type === 'multipleChoice') {
          $('#task-icon').html('<i style="color: #5b7814;" class="fa fa-check-square-o fa-2" aria-hidden="true"></i>');

          // Answers HTML
          answers = '<fieldset data-role="controlgroup"><legend><b>Choose one:</b></legend>';
          _.each(pub.game.answers, function (answer, i) {
            answers += '<input name="radio-choice-v-2" id="radio-choice-v-2-'+ i + '" value="' + answer + '" type="radio" required>'
              + '<label for="radio-choice-v-2-'+ i + '">' + answer + '</label>';
          });
          answers += '</fieldset>'

        // multipleChoicePhoto game type
        } else if (pub.game.type === 'multipleChoicePhoto') {
          $('#task-icon').html('<i style="color: #447884;" class="fa fa-binoculars fa-2" aria-hidden="true"></i>');

          // Answers HTML
          answers = '<fieldset data-role="controlgroup"><legend><b>Choose one:</b></legend>';
          _.each(pub.game.answers, function (answer, i) {
            answers += '<input name="radio-choice-v-2" id="radio-choice-v-2-'+ i + '" value="' + answer + '" type="radio" required>'
              + '<label for="radio-choice-v-2-'+ i + '">' + answer + '</label>';
          });
          answers += '</fieldset>'

        } else if (pub.game.type === 'input') {
          // TODO: Add input game type
        }

        answers += '<input type="hidden" name="pubId" value="' + pub.id + '">';
        $('#game-answers').html(answers);

        // General HTML or text for all game types
        $('#game-description').text(pub.game.description);

        var clues = '';
        _.each(pub.game.clues, function (clue) {
          clues += '<li>' + clue + '</li>';
        });
        $('#game-clues').html(clues);
      }

      function checkGame(e) {
        var id = $("input[type=hidden]").val();
        var pub = store.pubs[id] || store.pubs[0];
        var answer = '';

        if (pub.game.type === 'multipleChoice') {
          answer = $("input[name=radio-choice-v-2]:checked").val();
        } else if (pub.game.type === 'multipleChoicePhoto') {
          answer = $("input[name=radio-choice-v-2]:checked").val();
        }

        if (answer === pub.game.correctAnswer) {
          // TODO: Add points
          // Show Congratulations screen
          // Do not allow to play this game again
          alert('Correct answer!');
        } else {
          alert('wrong');
        }
      }

      function searchPub() {
        $('.pubs-result-div').show();
        var pubsList = $('#pubs-list');
        // Remove all childs to refresh the list
        pubsList.empty();

        _.each(store.pubs, function (pub) {
          var html = ''
            + '<div class="pubs-list-item">'
              + '<a href="#poi_page" onclick="loadPubData(' + pub.id + ');">'
              + '<span class="pubs-list-name"><b>' + pub.name+ '</b></span>'
              + '<span class="pubs-list-arrow"><i class="fa fa-chevron-right" aria-hidden="true"></i></span>'
              + '<span class="pubs-list-distance">0.2 miles</span>'
              + '<p class="pubs-list-description">' + pub.description + '</p>'
              + '</a>'
            + '</div>';
          pubsList.append(html);
        });

        pubsList.show();
        $('html, body').animate({
          scrollTop: $("#pubs-list").offset().top
        }, 500);
      }

      function togglePubFavourite(e, id) {
        var parent = $(e).parent();
        parent.empty();

        if (_.includes(store.favouritePubs, id)) {
          // Remove from favs
          _.pull(store.favouritePubs, id);
          parent.html('<i onclick="togglePubFavourite(this, ' + id +')" class="fa fa-star-o" aria-hidden="true"></i>');
        } else {
          // Add to favs
          store.favouritePubs.push(id);
          parent.html('<i onclick="togglePubFavourite(this, ' + id +')" class="fa fa-star" aria-hidden="true"></i>');
        }
      }

      function loadFavPubs() {
        var favPubsList = $('#fav-pubs-list');
        // Remove all childs to refresh the list
        favPubsList.empty();

        if (store.favouritePubs.length === 0) {
          var h = '<div align="center"> No favourite pubs yet, <a href="#find_pub">find a pub.</a></div>';
          favPubsList.append(h);
          $('#fav-buttons').hide();
          return;
        }

        $('#fav-buttons').show();

        _.each(store.favouritePubs, function (i) {
          var pub = store.pubs[i];
          var html = ''
            + '<a href="#poi_page" onclick="loadPubData(' + pub.id + ');">'
              + '<div class="pubs-list-item">'
              + '<span class="pubs-list-name"><b>' + pub.name+ '</b></span>'
              + '<span class="pubs-list-arrow"><i class="fa fa-chevron-right" aria-hidden="true"></i></span>'
              + '<p class="pubs-list-description">' + pub.description + '</p>'
              + '</div>';
            + '</a>'
          favPubsList.append(html);
        });

      }

    </script>

    <script>
      function initMap() {
        setTimeout(renderMap, 500);
      }
      function renderMap() {
        var uluru = { lat: 51.5228932, lng: -0.1268167 }; // Friend at Hand location
        var map = new google.maps.Map(document.getElementById('map-canvas'), {
          zoom: 13,
          center: uluru
        });

        var marker = new google.maps.Marker({
          position: uluru,
          map: map,
        });
      }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDS2IIQTdjabc_ZJygCIKXg-0nSE_4CkNw&callback=initMap"></script>

  </body>
</html>
